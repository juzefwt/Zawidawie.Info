(function(g,d,e){d.infinitescroll=function(a,c,b){this.element=d(b);this._create(a,c)};d.infinitescroll.defaults={callback:function(){},debug:!1,behavior:e,binder:d(g),nextSelector:"div.navigation a:first",loadMsgSelector:null,loadingMsgRevealSpeed:"fast",loadingImg:"http://www.infinite-scroll.com/loading.gif",loadingText:"<em>Loading the next set of posts...</em>",loadingStart:e,loadingEnd:e,donetext:"<em>Congratulations, you've reached the end of the internet.</em>",navSelector:"div.navigation",
contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:e,dataType:"html",appendCallback:!0,bufferPx:40,orientation:"height",errorCallback:function(){},currPage:1,infid:0,isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,pixelsFromNavToBottom:e,pagesLoaded:null,path:e,loadingMsg:e};d.infinitescroll.prototype={_binding:function(a){var c=this,b=c.options;if(b.behavior&&this["_binding_"+b.behavior]!==e)this["_binding_"+b.behavior].call(this);else{if(a!==
"bind"&&a!=="unbind")return this._debug("Binding value  "+a+" not valid"),!1;if(a=="unbind")this.options.binder.unbind("smartscroll.infscr."+c.options.infid);else this.options.binder[a]("smartscroll.infscr."+c.options.infid,function(){c.scroll()});this._debug("Binding",a)}},_create:function(a,c){if(!this._validate(a))return!1;var b=this.options=d.extend({},d.infinitescroll.defaults,a),e=d(b.nextSelector).attr("href");b.contentSelector=b.contentSelector||this.element;b.loadMsgSelector=b.loadMsgSelector||
b.contentSelector;e?(b.path=this._determinepath(e),b.loadingMsg=d('<div id="infscr-loading"><img alt="Loading..." src="'+b.loadingImg+'" /><div>'+b.loadingText+"</div></div>"),(new Image).src=b.loadingImg,b.pixelsFromNavToBottom=d(document).height()-d(b.navSelector).offset().top,b.loadingStart=b.loadingStart||function(){d(b.navSelector).hide();b.loadingMsg.appendTo(b.loadMsgSelector).show(b.loadingMsgRevealSpeed,function(){beginAjax(b)})},b.loadingEnd=b.loadingEnd||function(){b.loadingMsg.fadeOut("normal")},
b.callback=c||function(){},this._setup()):this._debug("Navigation selector not found")},_debug:function(){if(this.options.debug)return g.console&&console.log.call(console,arguments)},_determinepath:function(a){var c=this.options;if(c.behavior&&this["_determinepath_"+c.behavior]!==e)this["_determinepath_"+c.behavior].call(this,a);else{if(d.isFunction(c.pathParse))return this._debug("pathParse"),[a];else if(a.match(/^(.*?)\b2\b(.*?$)/))a=a.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(a.match(/^(.*?)2(.*?$)/)){if(a.match(/^(.*?page=)2(\/.*|$)/))return a=
a.match(/^(.*?page=)2(\/.*|$)/).slice(1);a=a.match(/^(.*?)2(.*?$)/).slice(1)}else if(a.match(/^(.*?page=)1(\/.*|$)/))return a=a.match(/^(.*?page=)1(\/.*|$)/).slice(1);else this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com."),c.isInvalidPage=!0;this._debug("determinePath",a);return a}},_error:function(a){var c=this.options;c.behavior&&
this["_error_"+c.behavior]!==e?this["_error_"+c.behavior].call(this,a):(a!=="destroy"&&a!=="end"&&(a="unknown"),this._debug("Error",a),a=="end"&&this._showdonemsg(),c.isDone=!0,c.currPage=1,c.isPaused=!1,this.binding("unbind"))},_loadcallback:function(a,c){var b=this.options,i=this.options.callback,f=b.isDone?"done":!b.appendCallback?"no-append":"append";if(b.behavior&&this["_loadcallback_"+b.behavior]!==e)this["_loadcallback_"+b.behavior].call(this,a,c);else{switch(f){case "done":return this._showdonemsg(),
!1;case "no-append":b.dataType=="html"&&(c=d("<div>"+c+"</div>").find(b.itemSelector));break;case "append":var h=a.children();if(h.length==0)return this._error("end");for(f=document.createDocumentFragment();a[0].firstChild;)f.appendChild(a[0].firstChild);this._debug("contentSelector",d(b.contentSelector)[0]);d(b.contentSelector)[0].appendChild(f);c=h.get()}b.loadingEnd.call(d(b.contentSelector)[0],b);b.animate&&(f=d(g).scrollTop()+d("#infscr-loading").height()+b.extraScrollPx+"px",d("html,body").animate({scrollTop:f},
800,function(){b.isDuringAjax=!1}));if(!b.animate)b.isDuringAjax=!1;i.call(d(b.contentSelector)[0],c)}},_nearbottom:function(){var a=this.options,c=0+d(document).height()-a.binder.scrollTop()-d(g).height();if(a.behavior&&this["_nearbottom_"+a.behavior]!==e)this["_nearbottom_"+a.behavior].call(this);else return this._debug("math:",c,a.pixelsFromNavToBottom),c-a.bufferPx<a.pixelsFromNavToBottom},_pausing:function(a){var c=this.options;if(c.behavior&&this["_pausing_"+c.behavior]!==e)this["_pausing_"+
c.behavior].call(this,a);else{a!=="pause"&&a!=="resume"&&a!==null&&this._debug("Invalid argument. Toggling pause value instead");switch(a&&(a=="pause"||a=="resume")?a:"toggle"){case "pause":c.isPaused=!0;break;case "resume":c.isPaused=!1;break;case "toggle":c.isPaused=!c.isPaused}this._debug("Paused",c.isPaused);return!1}},_setup:function(){var a=this.options;if(a.behavior&&this["_setup_"+a.behavior]!==e)this["_setup_"+a.behavior].call(this);else return this._binding("bind"),!1},_showdonemsg:function(){var a=
this.options;a.behavior&&this["_showdonemsg_"+a.behavior]!==e?this["_showdonemsg_"+a.behavior].call(this):(a.loadingMsg.find("img").hide().parent().find("div").html(a.donetext).animate({opacity:1},2E3,function(){d(this).parent().fadeOut("normal")}),a.errorCallback.call(d(a.contentSelector)[0],"done"))},_validate:function(a){for(var c in a){if(c.indexOf&&c.indexOf("Selector")>-1&&d(a[c]).length===0)return this._debug("Your "+c+" found no elements."),!1;return!0}},bind:function(){this._binding("bind")},
destroy:function(){this.options.isDestroyed=!0;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(a){var c=this,b=c.options,i=b.path,f,h,g,j,a=a||null;beginAjax=function(a){a.currPage++;c._debug("heading into ajax",i);f=d(a.contentSelector).is("table")?d("<tbody/>"):d("<div/>");h=d.isFunction(a.pathParse)?a.pathParse(i.join("2"),a.currPage):i.join(a.currPage);g=a.dataType=="html"||a.dataType=="json"?a.dataType:"html+callback";
a.appendCallback&&a.dataType=="html"&&(g+="+callback");switch(g){case "html+callback":c._debug("Using HTML via .load() method");f.load(h+" "+a.itemSelector,null,function(a){c._loadcallback(f,a)});break;case "html":case "json":c._debug("Using "+g.toUpperCase()+" via $.ajax() method"),d.ajax({url:h,dataType:a.dataType,complete:function(a,b){(j=typeof a.isResolved!=="undefined"?a.isResolved():b==="success"||b==="notmodified")?c._loadcallback(f,a.responseText):c._error("end")}})}};if(b.behavior&&this["retrieve_"+
b.behavior]!==e)this["retrieve_"+b.behavior].call(this,a);else{if(b.isDestroyed)return this._debug("Instance is destroyed"),!1;b.isDuringAjax=!0;b.loadingStart.call(d(b.contentSelector)[0],b)}},scroll:function(){var a=this.options;a.behavior&&this["scroll_"+a.behavior]!==e?this["scroll_"+a.behavior].call(this):!a.isDuringAjax&&!a.isInvalidPage&&!a.isDone&&!a.isDestroyed&&!a.isPaused&&this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")}};
d.fn.infinitescroll=function(a,c){switch(typeof a){case "string":var b=Array.prototype.slice.call(arguments,1);this.each(function(){var c=d.data(this,"infinitescroll");if(!c)return!1;if(!d.isFunction(c[a])||a.charAt(0)==="_")return!1;c[a].apply(c,b)});break;case "object":this.each(function(){d.data(this,"infinitescroll")||d.data(this,"infinitescroll",new d.infinitescroll(a,c,this))})}return this};var j=d.event,k;j.special.smartscroll={setup:function(){d(this).bind("scroll",j.special.smartscroll.handler)},
teardown:function(){d(this).unbind("scroll",j.special.smartscroll.handler)},handler:function(a,c){var b=this,d=arguments;a.type="smartscroll";k&&clearTimeout(k);k=setTimeout(function(){jQuery.event.handle.apply(b,d)},c==="execAsap"?0:100)}};d.fn.smartscroll=function(a){return a?this.bind("smartscroll",a):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);
